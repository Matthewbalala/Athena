# version: '3'  
# peer { name, org, version, network, mountpath, action}
# services:
  {{name}}:
      image: hyperledger/fabric-peer:{{peer.version}}
      dns: {{peer.dnsserver}}
      container_name: {{name}}
      environment:
      - GODEBUG=netdns=go
      - FABRIC_LOGGING_SPEC=grpc=info:info
      - CORE_CHAINCODE_LOGGING_LEVEL=INFO
      - CORE_CHAINCODE_LOGGING_SHIM=INFO
      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
      - CORE_PEER_ID={{name}}
      - CORE_PEER_ENDORSER_ENABLED=true
      - CORE_PEER_LOCALMSPID={{name.split(".")[1].capitalize()}}MSP
      - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:7052
      - CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/msp/peer/msp/
      - CORE_PEER_ADDRESS={{name}}:7051
      - CORE_PEER_GOSSIP_USELEADERELECTION=true
      - CORE_PEER_GOSSIP_ORGLEADER=false
      - CORE_PEER_GOSSIP_EXTERNALENDPOINT={{name}}:7051
      - CORE_PEER_TLS_ENABLED=true
      - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/msp/peer/tls/server.key
      - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/msp/peer/tls/server.crt
      - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/msp/peer/tls/ca.crt
      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE={{peer.network}}
      - CORE_OPERATIONS_LISTENADDRESS={{name}}:9443
      - CORE_METRICS_PROVIDER=prometheus
       # limingxuan add
      # - CORE_CHAINCODE_EXECUTETIMEOUT={{action['CORE_CHAINCODE_EXECUTETIMEOUT']}}
      # - CORE_LEDGER_TOTALQUERYLIMIT={{action['CORE_LEDGER_TOTALQUERYLIMIT']}}
      # - CORE_METRICS_STATSD_WRITEINTERVAL={{action['CORE_METRICS_STATSD_WRITEINTERVAL']}}
      - CORE_PEER_AUTHENTICATION_TIMEWINDOW={{action['CORE_PEER_AUTHENTICATION_TIMEWINDOW']}}
      - CORE_PEER_CLIENT_CONNTIMEOUT={{action['CORE_PEER_CLIENT_CONNTIMEOUT']}}
      - CORE_PEER_DELIVERYCLIENT_CONNTIMEOUT={{action['CORE_PEER_DELIVERYCLIENT_CONNTIMEOUT']}}
      - CORE_PEER_DELIVERYCLIENT_RECONNECTBACKOFFTHRESHOLD={{action['CORE_PEER_DELIVERYCLIENT_RECONNECTBACKOFFTHRESHOLD']}}
      - CORE_PEER_DELIVERYCLIENT_RECONNECTTOTALTIMETHRESHOLD={{action['CORE_PEER_DELIVERYCLIENT_RECONNECTTOTALTIMETHRESHOLD']}}
      - CORE_PEER_DISCOVERY_AUTHCACHEMAXSIZE={{action['CORE_PEER_DISCOVERY_AUTHCACHEMAXSIZE']}}
      - CORE_PEER_DISCOVERY_AUTHCACHEPURGERETENTIONRATIO={{action['CORE_PEER_DISCOVERY_AUTHCACHEPURGERETENTIONRATIO']}}
      - CORE_PEER_GOSSIP_ALIVEEXPIRATIONTIMEOUT={{action['CORE_PEER_GOSSIP_ALIVEEXPIRATIONTIMEOUT']}}
      - CORE_PEER_GOSSIP_ALIVETIMEINTERVAL={{action['CORE_PEER_GOSSIP_ALIVETIMEINTERVAL']}}
      - CORE_PEER_GOSSIP_CONNTIMEOUT={{action['CORE_PEER_GOSSIP_CONNTIMEOUT']}}
      - CORE_PEER_GOSSIP_DIALTIMEOUT={{action['CORE_PEER_GOSSIP_DIALTIMEOUT']}}
      - CORE_PEER_GOSSIP_DIGESTWAITTIME={{action['CORE_PEER_GOSSIP_DIGESTWAITTIME']}}
      - CORE_PEER_GOSSIP_ELECTION_LEADERALIVETHRESHOLD={{action['CORE_PEER_GOSSIP_ELECTION_LEADERALIVETHRESHOLD']}}
      - CORE_PEER_GOSSIP_ELECTION_MEMBERSHIPSAMPLEINTERVAL={{action['CORE_PEER_GOSSIP_ELECTION_MEMBERSHIPSAMPLEINTERVAL']}}
      - CORE_PEER_GOSSIP_ELECTION_STARTUPGRACEPERIOD={{action['CORE_PEER_GOSSIP_ELECTION_STARTUPGRACEPERIOD']}}
      - CORE_PEER_GOSSIP_MAXBLOCKCOUNTTOSTORE={{action['CORE_PEER_GOSSIP_MAXBLOCKCOUNTTOSTORE']}}
      - CORE_PEER_GOSSIP_MAXPROPAGATIONBURSTLATENCY={{action['CORE_PEER_GOSSIP_MAXPROPAGATIONBURSTLATENCY']}}
      - CORE_PEER_GOSSIP_MAXPROPAGATIONBURSTSIZE={{action['CORE_PEER_GOSSIP_MAXPROPAGATIONBURSTSIZE']}}
      - CORE_PEER_GOSSIP_MEMBERSHIPTRACKERINTERVAL={{action['CORE_PEER_GOSSIP_MEMBERSHIPTRACKERINTERVAL']}}
      - CORE_PEER_GOSSIP_PROPAGATEITERATIONS={{action['CORE_PEER_GOSSIP_PROPAGATEITERATIONS']}}
      - CORE_PEER_GOSSIP_PROPAGATEPEERNUM={{action['CORE_PEER_GOSSIP_PROPAGATEPEERNUM']}}
      - CORE_PEER_GOSSIP_PUBLISHCERTPERIOD={{action['CORE_PEER_GOSSIP_PUBLISHCERTPERIOD']}}
      - CORE_PEER_GOSSIP_PUBLISHSTATEINFOINTERVAL={{action['CORE_PEER_GOSSIP_PUBLISHSTATEINFOINTERVAL']}}
      - CORE_PEER_GOSSIP_PULLINTERVAL={{action['CORE_PEER_GOSSIP_PULLINTERVAL']}}
      - CORE_PEER_GOSSIP_PULLPEERNUM={{action['CORE_PEER_GOSSIP_PULLPEERNUM']}}
      - CORE_PEER_GOSSIP_RECONNECTINTERVAL={{action['CORE_PEER_GOSSIP_RECONNECTINTERVAL']}}
      - CORE_PEER_GOSSIP_RECVBUFFSIZE={{action['CORE_PEER_GOSSIP_RECVBUFFSIZE']}}
      - CORE_PEER_GOSSIP_REQUESTSTATEINFOINTERVAL={{action['CORE_PEER_GOSSIP_REQUESTSTATEINFOINTERVAL']}}
      - CORE_PEER_GOSSIP_REQUESTWAITTIME={{action['CORE_PEER_GOSSIP_REQUESTWAITTIME']}}
      - CORE_PEER_GOSSIP_RESPONSEWAITTIME={{action['CORE_PEER_GOSSIP_RESPONSEWAITTIME']}}
      - CORE_PEER_GOSSIP_SENDBUFFSIZE={{action['CORE_PEER_GOSSIP_SENDBUFFSIZE']}}
      - CORE_PEER_GOSSIP_STATE_BATCHSIZE={{action['CORE_PEER_GOSSIP_STATE_BATCHSIZE']}}
      - CORE_PEER_GOSSIP_STATE_BLOCKBUFFERSIZE={{action['CORE_PEER_GOSSIP_STATE_BLOCKBUFFERSIZE']}}
      - CORE_PEER_GOSSIP_STATE_CHECKINTERVAL={{action['CORE_PEER_GOSSIP_STATE_CHECKINTERVAL']}}
      - CORE_PEER_GOSSIP_STATE_MAXRETRIES={{action['CORE_PEER_GOSSIP_STATE_MAXRETRIES']}}
      - CORE_PEER_GOSSIP_STATE_RESPONSETIMEOUT={{action['CORE_PEER_GOSSIP_STATE_RESPONSETIMEOUT']}}
      - CORE_PEER_KEEPALIVE_CLIENT_INTERVAL={{action['CORE_PEER_KEEPALIVE_CLIENT_INTERVAL']}}
      - CORE_PEER_KEEPALIVE_CLIENT_TIMEOUT={{action['CORE_PEER_KEEPALIVE_CLIENT_TIMEOUT']}}
      - CORE_PEER_KEEPALIVE_DELIVERYCLIENT_INTERVAL={{action['CORE_PEER_KEEPALIVE_DELIVERYCLIENT_INTERVAL']}}
      - CORE_PEER_KEEPALIVE_DELIVERYCLIENT_TIMEOUT={{action['CORE_PEER_KEEPALIVE_DELIVERYCLIENT_TIMEOUT']}}
      - CORE_PEER_KEEPALIVE_MININTERVAL={{action['CORE_PEER_KEEPALIVE_MININTERVAL']}}
      working_dir: /opt/gopath/src/github.com/hyperledger/fabric
      command: peer node start
      ports:
      - {{peer.port}}:7051
      - {{peer.port+1}}:9443
      volumes:
      - /var/run/:/host/var/run/
      - {{peer.mountpath}}/crypto-config/peerOrganizations/{{'.'.join(name.split('.')[1:])}}/peers/{{name}}/:/etc/hyperledger/msp/peer
      # networks:
      #   - {{peer.network}}